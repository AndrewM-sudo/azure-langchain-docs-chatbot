# Backend API

FastAPI backend for the Azure LangChain Docs Chatbot.

## Setup

### Prerequisites
- Python 3.12 or 3.13 (Python 3.14 may have compatibility issues with LangChain)
- Azure OpenAI account with a deployed chat model

### Installation

1. Install dependencies:
```powershell
py -m pip install -r requirements.txt
```

2. Create a `.env` file in the root directory with your Azure OpenAI credentials:
```env
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_KEY=your-api-key-here
AZURE_OPENAI_API_VERSION=2024-08-01-preview
AZURE_OPENAI_CHAT_DEPLOYMENT=your-deployment-name
AZURE_OPENAI_EMBED_DEPLOYMENT=your-embeddings-deployment-name
FRONTEND_ORIGIN=http://localhost:5173
```

## Running the API

Start the development server with auto-reload:
```powershell
py -m uvicorn backend.app.main:app --reload
```

The API will be available at: `http://127.0.0.1:8000`

## API Endpoints

### Health Check
- **URL:** `http://127.0.0.1:8000/v1/health`
- **Method:** `GET`
- **Description:** Check if the API is running
- **Response:**
  ```json
  {
    "status": "ok"
  }
  ```

### Chat
- **URL:** `http://127.0.0.1:8000/v1/chat`
- **Method:** `POST`
- **Description:** Send a message to the chatbot
- **Request Body:**
  ```json
  {
    "message": "Your question here"
  }
  ```
- **Response:**
  ```json
  {
    "answer": "AI response here"
  }
  ```

## API Documentation

Interactive API documentation is automatically generated by FastAPI:
- **Swagger UI:** `http://127.0.0.1:8000/docs`
- **ReDoc:** `http://127.0.0.1:8000/redoc`

## Project Structure

```
backend/
├── app/
│   ├── routers/
│   │   ├── chat.py      # Chat endpoint
│   │   └── health.py    # Health check endpoint
│   ├── config.py        # Environment configuration
│   ├── llm.py          # Azure OpenAI integration
│   └── main.py         # FastAPI application
├── requirements.txt     # Python dependencies
└── README.md           # This file
```

## Troubleshooting

### Port Already in Use
If port 8000 is already in use, specify a different port:
```powershell
py -m uvicorn backend.app.main:app --reload --port 8001
```

### Module Import Errors
Make sure you're running the command from the project root directory.

### Azure OpenAI Errors
- Verify your `.env` file is in the correct location (project root)
- Check that your deployment name matches the one in Azure Portal
- Ensure your API key is valid and has the necessary permissions
